## Review

- Read agent-loop.sh in full. Then carefully audit it for: (1) bugs or edge cases in parse_tasks, run_claude, execute_tasks, extract_token_usage, and _handle_interrupt; (2) fragile bash patterns such as dynamic scoping in flush_task, colon-delimited return values from run_claude, and the raw/argjson flag in update_task_state; (3) gaps in test coverage — look at tests/test-dir-flag.sh and tests/test-features.sh and note which code paths lack tests; (4) usability or robustness improvements, e.g. SESSION_TOKENS not persisted across resumes, daily log date format inconsistency, slugify not capping group slug length, analyze_failure using hardcoded "haiku" model name. Write your full findings as a structured Markdown report to REVIEW.md. Use sections: Bugs & Edge Cases, Fragile Patterns, Test Coverage Gaps, Improvement Suggestions. Be specific — include line numbers and code snippets.
